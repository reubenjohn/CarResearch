from unittest import TestCase

from car_researcher.scrape.kbb_search import scrape_kbb_search, ListItem, PriceRibbon
from car_researcher.scrape.kbb_listing import Mileage
from tests.scrape.fetch import StatelessTestVectorFetcher


class Test(TestCase):
    def test_scrape_kbb_search(self):
        results = scrape_kbb_search('kbb_search', StatelessTestVectorFetcher())
        self.maxDiff = 1024 * 1024
        for i, (result, expected) in enumerate(zip(results, EXPECTED_RESULTS)):
            self.assertEqual(result, expected, 'Item ' + str(i))


EXPECTED_RESULTS = [
    ListItem(vin='3GCPDBEK9PG268088', title='New 2023 Chevrolet Silverado 1500 Custom',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=679456113',
             image_url='https://atcimages.kbb.com/hn/c/22b69d9d44fb40bdb36cbe50d1842c0e.jpg', price_usd=45460,
             production_year=2023, brand_name='Chevrolet', model_name='Silverado 1500',
             miles=8, city_mpg=18, hwy_mpg=21, wheel_drive='4 Wheel Drive', color='Gray',
             seller_name='Landers McLarty Chevrolet', seller_phone='2567156557',
             seller_address='4930 University Drive\nHuntsville, AL 35816', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1GKS2DKL8MR113282', title='Certified 2021 GMC Yukon Denali w/ Denali Premium Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=678005720',
             image_url='https://atcimages.kbb.com/hn/c/645e2f19a14f45f1a823006ca7b07e9a.jpg', price_usd=71995,
             production_year=2021, brand_name='GMC', model_name='Yukon', miles=31440,
             city_mpg=14, hwy_mpg=19, wheel_drive='4 Wheel Drive', color='Black',
             seller_name='Paul Sur Buick GMC', seller_phone='2193862790',
             seller_address='1551 US Hwy 30\nValparaiso, IN 46385', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='WP1AB2AY6NDA32240', title='Used 2022 Porsche Cayenne S',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686951775',
             image_url='//atcimages.kbb.com/hn/c/57a8ad41f9954e488882a12594f49a03.jpg', price_usd=91995,
             production_year=2022, brand_name='Porsche', model_name='Cayenne', miles=9412, city_mpg=None, hwy_mpg=None,
             wheel_drive='All wheel drive', color='White', seller_name='Paul Miller Porsche', seller_phone='9736587631',
             seller_address='3419 US HIGHWAY 46\nParsippany, NJ 07054', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='3MW5R7J06L8B28110', title='Used 2020 BMW 330i xDrive Sedan w/ M Sport Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686810384',
             image_url='//atcimages.kbb.com/hn/c/9e490fbb09824dd381d4b2fc6942a13f.jpg', price_usd=33888,
             production_year=2020, brand_name='BMW', model_name='330i xDrive', miles=29149, city_mpg=None, hwy_mpg=None,
             wheel_drive='All wheel drive', color='Gray', seller_name='Paul Miller BMW', seller_phone='9735876590',
             seller_address='1515 State Route 23\nWayne, NJ 07470', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='WP0AC2Y17LSA72376', title='Used 2020 Porsche Taycan Turbo S',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686714164',
             image_url='//atcimages.kbb.com/hn/c/008109b920d84226900de2936680fa4c.jpg', price_usd=127995,
             production_year=2020, brand_name='Porsche', model_name='Taycan', miles=12014, city_mpg=None, hwy_mpg=None,
             wheel_drive='All wheel drive', color='Gray', seller_name='Paul Miller Porsche', seller_phone='9736587631',
             seller_address='3419 US HIGHWAY 46\nParsippany, NJ 07054', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='3KPA24AD6ME417157', title='Certified 2021 Kia Rio S w/ Technology Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686842968',
             image_url='//atcimages.kbb.com/hn/c/807496fe449540338d96cfc7849b3350.jpg', price_usd=19193,
             production_year=2021, brand_name='Kia', model_name='Rio', miles=12362, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Black', seller_name='Kia Fort Walton Beach',
             seller_phone='8506597309', seller_address='343 MIRACLE STRIP PKWY SW\nFort Walton Beach, FL 32548',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='2GNAXKEV9L6177665', title='Certified 2020 Chevrolet Equinox LT',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686819099',
             image_url='//atcimages.kbb.com/hn/c/d37dcad1e8c34fb19805428765ed4444.jpg', price_usd=23884,
             production_year=2020, brand_name='Chevrolet', model_name='Equinox', miles=7590, city_mpg=None,
             hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Brown', seller_name='Serpentini Chevrolet Willoughby Hills',
             seller_phone='8335950340', seller_address='2810 BISHOP RD\nWilloughby Hills, OH 44092',
             price_ribbon=PriceRibbon.NONE), ListItem(vin='1G1ZD5ST1MF032404', title='Used 2021 Chevrolet Malibu LT',
                                                      listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=681902564',
                                                      image_url='https://atcimages.kbb.com/hn/c/a806fed96eff4c809fcd84cc9a15805c.jpg',
                                                      price_usd=22941, production_year=2021,
                                                      brand_name='Chevrolet',
                                                      model_name='Malibu', miles=63326,
                                                      city_mpg=29, hwy_mpg=36,
                                                      wheel_drive='2 Wheel Drive - Front', color='Silver',
                                                      seller_name='Andy Mohr Speedway Chevrolet Inc',
                                                      seller_phone='3176614599',
                                                      seller_address='5252 W 38th Street\nIndianapolis, IN 46254',
                                                      price_ribbon=PriceRibbon.NONE),
    ListItem(vin='SHHFK7H66MU426657', title='Used 2021 Honda Civic EX',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686735167',
             image_url='//atcimages.kbb.com/hn/c/89355cf53c0945fbb6b6fdce13142845.jpg', price_usd=25904,
             production_year=2021, brand_name='Honda', model_name='Civic', miles=17044, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Silver', seller_name='Ourisman Jeep',
             seller_phone='2406508679', seller_address='6700 WISCONSIN AVE\nChevy Chase, MD 20815',
             price_ribbon=PriceRibbon.NONE), ListItem(vin='1G1ZD5ST4NF205107', title='Used 2022 Chevrolet Malibu LT',
                                                      listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686830354',
                                                      image_url='//atcimages.kbb.com/hn/c/173d1d1ac7514732aa19b8b574cd089f.jpg',
                                                      price_usd=26749, production_year=2022, brand_name='Chevrolet',
                                                      model_name='Malibu', miles=2688, city_mpg=None, hwy_mpg=None,
                                                      wheel_drive='2 wheel drive - front', color='Gray',
                                                      seller_name='Chevrolet GMC of Mount Vernon',
                                                      seller_phone='7404627222',
                                                      seller_address='510 HARCOURT RD\nMount Vernon, OH 43050',
                                                      price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1HGCV1F39LA128615', title='Certified 2020 Honda Accord Sport',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686731430',
             image_url='//atcimages.kbb.com/hn/c/eb44853dff83492b967dcac5990a7aab.jpg', price_usd=27269,
             production_year=2020, brand_name='Honda', model_name='Accord', miles=13639, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Gray', seller_name='Ocean Honda', seller_phone='7278536676',
             seller_address='8442 U.S. Highway  19\nPort Richey, FL 34668', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='5N1AT3BA4MC789952', title='Used 2021 Nissan Rogue SV w/ Premium Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687319924',
             image_url='//atcimages.kbb.com/hn/c/a28420aa85f640ebb074b12540e2ba2d.jpg', price_usd=27953,
             production_year=2021, brand_name='Nissan', model_name='Rogue', miles=19171, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='White', seller_name='Cavender Nissan of Rockwall',
             seller_phone='9729612319', seller_address='1700 E INTERSTATE 30\nRockwall, TX 75087',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1C4RJEAG2LC393077', title='Used 2020 Jeep Grand Cherokee Laredo',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687048402',
             image_url='//atcimages.kbb.com/hn/c/20377ce3f3ef458ba4e8f20a86223de2.jpg', price_usd=28900,
             production_year=2020, brand_name='Jeep', model_name='Grand Cherokee', miles=23898, city_mpg=None,
             hwy_mpg=None,
             wheel_drive='2 wheel drive - rear', color='Black', seller_name='Cavender Cadillac',
             seller_phone='2106864450', seller_address='7625 N Loop 1604 E\nLive Oak, TX 78233',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='JTDKARFU5L3111165', title='Certified 2020 Toyota Prius Limited',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686807361',
             image_url='//atcimages.kbb.com/hn/c/b3703a626204434ba46820f3bca98a1e.jpg', price_usd=28999,
             production_year=2020, brand_name='Toyota', model_name='Prius', miles=25846, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='White', seller_name='Toyota Marin', seller_phone='4155786927',
             seller_address='445 FRANCISCO BLVD E\nSan Rafael, CA 94901', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='KL79MSSL2MB121571', title='Certified 2021 Chevrolet TrailBlazer ACTIV w/ Sun and Liftgate Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686810345',
             image_url='//atcimages.kbb.com/hn/c/7670243a213d48c798d0435e13c9466f.jpg', price_usd=29980,
             production_year=2021, brand_name='Chevrolet', model_name='TrailBlazer', miles=18037, city_mpg=None,
             hwy_mpg=None,
             wheel_drive='All wheel drive', color='Black', seller_name='Hugh White Chevrolet Buick',
             seller_phone='7407857342', seller_address='2510 N MEMORIAL DR\nLancaster, OH 43130',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='5XXG64J20PG187947', title='Certified 2023 Kia K5 GT-Line w/ GT-Line Premium Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687024670',
             image_url='//atcimages.kbb.com/hn/c/ede2d9a526f24fc789f4fc1fd7792c5e.jpg', price_usd=32998,
             production_year=2023, brand_name='Kia', model_name='K5', miles=2079, city_mpg=None, hwy_mpg=None,
             wheel_drive='All wheel drive', color='White', seller_name='Pohanka Kia of Salisbury',
             seller_phone='6672533268', seller_address='1911 N SALISBURY BLVD\nSalisbury, MD 21801',
             price_ribbon=PriceRibbon.NONE), ListItem(vin='1N6ED1EJ0NN671189', title='Used 2022 Nissan Frontier SV',
                                                      listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686925414',
                                                      image_url='//atcimages.kbb.com/hn/c/7b51696df7eb4cdca9723563849549df.jpg',
                                                      price_usd=33490, production_year=2022, brand_name='Nissan',
                                                      model_name='Frontier', miles=5323, city_mpg=None, hwy_mpg=None,
                                                      wheel_drive='2 wheel drive - rear', color='Black',
                                                      seller_name='Cavender Nissan of Rockwall',
                                                      seller_phone='9729612319',
                                                      seller_address='1700 E INTERSTATE 30\nRockwall, TX 75087',
                                                      price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1FTER1FH1LLA79289', title='Used 2020 Ford Ranger XLT w/ Equipment Group 301A Mid',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686706222',
             image_url='//atcimages.kbb.com/hn/c/a3c1ff8ee86a437b848aab1cd3793a8e.jpg', price_usd=33980,
             production_year=2020, brand_name='Ford', model_name='Ranger', miles=7498, city_mpg=None, hwy_mpg=None,
             wheel_drive='4 wheel drive', color='Silver', seller_name='Serpentini Chevrolet Willoughby Hills',
             seller_phone='8335950340', seller_address='2810 BISHOP RD\nWilloughby Hills, OH 44092',
             price_ribbon=PriceRibbon.NONE), ListItem(vin='5FNYF5H69LB002990', title='Used 2020 Honda Pilot Touring',
                                                      listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687011703',
                                                      image_url='//atcimages.kbb.com/hn/c/fcd30da58f434be9b14dcb2a30c3cfde.jpg',
                                                      price_usd=34228, production_year=2020, brand_name='Honda',
                                                      model_name='Pilot', miles=36472, city_mpg=None, hwy_mpg=None,
                                                      wheel_drive='2 wheel drive - front', color='Black',
                                                      seller_name='Norm Reeves Honda Superstore West Covina',
                                                      seller_phone='6265419088',
                                                      seller_address='1840 East Garvey Avenue South\nWest Covina, CA 91791',
                                                      price_ribbon=PriceRibbon.NONE),
    ListItem(vin='19UUB5F52MA008744', title='Used 2021 Acura TLX w/ A-SPEC Pkg',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686902492',
             image_url='//atcimages.kbb.com/hn/c/5466643440904354a1ebebff5c96c610.jpg', price_usd=36500,
             production_year=2021, brand_name='Acura', model_name='TLX', miles=15911, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Red', seller_name='Cavender Buick GMC North',
             seller_phone='7266661735', seller_address='17811 San Pedro Avenue\nSan Antonio, TX 78232',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='LRBFZRR41ND071796', title='Used 2022 Buick Envision Avenir w/ Safety Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686810940',
             image_url='//atcimages.kbb.com/hn/c/ba1f6d4163964abd9f2d111228495c9d.jpg', price_usd=38900,
             production_year=2022, brand_name='Buick', model_name='Envision', miles=7175, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Blue', seller_name='Cavender Cadillac',
             seller_phone='2106864450', seller_address='7625 N Loop 1604 E\nLive Oak, TX 78233',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1C4RJFCG1LC363667', title='Used 2020 Jeep Grand Cherokee Overland',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=673953414',
             image_url='//atcimages.kbb.com/hn/c/66303a614d2e44a487b1d7464e08759c.jpg', price_usd=38995,
             production_year=2020, brand_name='Jeep', model_name='Grand Cherokee', miles=24800, city_mpg=None,
             hwy_mpg=None,
             wheel_drive='4 wheel drive', color='Black', seller_name='Auto Outlets of Webster',
             seller_phone='5856264235', seller_address='824 RIDGE RD\nWebster, NY 14580',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1G6DT5RWXL0137550', title='Certified 2020 Cadillac CT5 Premium Luxury w/ Platinum Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687168551',
             image_url='//atcimages.kbb.com/hn/c/f43189194b6b4c4c99e4ee2d5b079ae5.jpg', price_usd=39800,
             production_year=2020, brand_name='Cadillac', model_name='CT5', miles=25564, city_mpg=None, hwy_mpg=None,
             wheel_drive='All wheel drive', color='White', seller_name='Cavender Cadillac', seller_phone='2106403231',
             seller_address='7625 N Loop 1604 E\nLive Oak, TX 78233', price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1C6SRFFT2MN772454', title='Used 2021 RAM 1500 Big Horn',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687040742',
             image_url='//atcimages.kbb.com/hn/c/60d615ffea074861b8560e247eeb00f8.jpg', price_usd=42778,
             production_year=2021, brand_name='RAM', model_name='1500', miles=13352, city_mpg=None, hwy_mpg=None,
             wheel_drive='4 wheel drive', color='Blue', seller_name='Rouen Chrysler Dodge Jeep',
             seller_phone='18666848507', seller_address='1091 Fremont Pike\nWoodville, OH 43469',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='1FM5K8GC9LGC85867', title='Used 2020 Ford Explorer ST w/ ST Street Pack',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686725394',
             image_url='//atcimages.kbb.com/hn/c/42a761384c2144ad9afde60d3851f720.jpg', price_usd=44900,
             production_year=2020, brand_name='Ford', model_name='Explorer', miles=20493, city_mpg=None, hwy_mpg=None,
             wheel_drive='4 wheel drive', color='White', seller_name='Hennessy Ford Lincoln Atlanta',
             seller_phone='7702794731', seller_address='5675 PEACHTREE INDUSTRIAL BLVD\nAtlanta, GA 30341',
             price_ribbon=PriceRibbon.NONE), ListItem(vin='JTEHU5JR0M5867937', title='Used 2021 Toyota 4Runner Venture',
                                                      listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686813576',
                                                      image_url='//atcimages.kbb.com/hn/c/abcafcb1a5ad401bac4f433c7fe31bf4.jpg',
                                                      price_usd=47500, production_year=2021, brand_name='Toyota',
                                                      model_name='4Runner', miles=12455, city_mpg=None, hwy_mpg=None,
                                                      wheel_drive='4 wheel drive', color='Red',
                                                      seller_name='Automaxx of the Carolinas',
                                                      seller_phone='8434800045',
                                                      seller_address='1016 North Main Street\nSummerville, SC 29483',
                                                      price_ribbon=PriceRibbon.NONE),
    ListItem(vin='5GAERDKW6PJ221242', title='Used 2023 Buick Enclave Avenir w/ Avenir Technology Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=687198039',
             image_url='//atcimages.kbb.com/hn/c/e8ac637d68514232813c411a53883057.jpg', price_usd=50998,
             production_year=2023, brand_name='Buick', model_name='Enclave', miles=440, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Green', seller_name='Buick GMC Cadillac Fort Walton Beach',
             seller_phone='8503578732', seller_address='329 MIRACLE STRIP PKWY SW\nFort Walton Beach, FL 32548',
             price_ribbon=PriceRibbon.NONE),
    ListItem(vin='5GAERDKW7PJ122994', title='Certified 2023 Buick Enclave Avenir w/ Avenir Technology Package',
             listing_url='https://www.kbb.com/cars-for-sale/vehicledetails.xhtml?listingId=686728272',
             image_url='//atcimages.kbb.com/hn/c/116a523cba1b42fb914d67323fdfdf53.jpg', price_usd=51900,
             production_year=2023, brand_name='Buick', model_name='Enclave', miles=7480, city_mpg=None, hwy_mpg=None,
             wheel_drive='2 wheel drive - front', color='Blue', seller_name='Cavender Buick GMC North',
             seller_phone='7266661135', seller_address='17811 San Pedro Avenue\nSan Antonio, TX 78232',
             price_ribbon=PriceRibbon.NONE)]
